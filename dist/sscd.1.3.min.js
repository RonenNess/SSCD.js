var SSCD=SSCD||{};SSCD.VERSION=1.3,SSCD.World=function(t){t=t||{},t.grid_size=t.grid_size||512,t.grid_error=void 0!==t.grid_error?t.grid_error:2,this.__grid={},this.__params=t,this.__all_shapes={},this.__collision_tags={},this.__next_coll_tag=0},SSCD.World.prototype={__create_collision_tag:function(t){if(this.__collision_tags[t])throw new SSCD.IllegalActionError("Collision tag named '"+t+"' already exist!");this.__collision_tags[t]=1<<this.__next_coll_tag++},_ALL_TAGS_VAL:Number.MAX_SAFE_INTEGER||4294967295,cleanup:function(){for(var t=Object.keys(this.__grid),i=0;i<t.length;++i){for(var _=t[i],e=Object.keys(this.__grid[_]),s=0;s<e.length;++s){var o=e[s];0===this.__grid[_][o].length&&delete this.__grid[_][o]}0===Object.keys(this.__grid[_]).length&&delete this.__grid[_]}},__get_tags_value:function(t){if(void 0===t)return this._ALL_TAGS_VAL;if("string"==typeof t)return this.__collision_tag(t);for(var i=0,_=0;_<t.length;++_)i|=this.__collision_tag(t[_]);return i},__collision_tag:function(t){return void 0===this.__collision_tags[t]&&this.__create_collision_tag(t),this.__collision_tags[t]},__get_grid_range:function(t){var i=t.get_aabb(),_=Math.floor(i.position.x/this.__params.grid_size),e=Math.floor(i.position.y/this.__params.grid_size),s=Math.floor((i.position.x+i.size.x)/this.__params.grid_size),o=Math.floor((i.position.y+i.size.y)/this.__params.grid_size);return{min_x:_,min_y:e,max_x:s,max_y:o}},add:function(t){if(t.__world)throw new SSCD.IllegalActionError("Object to add is already in a collision world!");for(var i=this.__get_grid_range(t),_=i.min_x;_<=i.max_x;++_)for(var e=i.min_y;e<=i.max_y;++e){this.__grid[_]=this.__grid[_]||{},this.__grid[_][e]=this.__grid[_][e]||[];var s=this.__grid[_][e];s.push(t),t.__grid_chunks.push(s)}return t.__world=this,t.__grid_bounderies=i,t.__last_insert_aabb=t.get_aabb().clone(),this.__all_shapes[t.get_id()]=t,t},get_all_shapes:function(){var t=[];for(var i in this.__all_shapes)this.__all_shapes.hasOwnProperty(i)&&t.push(this.__all_shapes[i]);return t},remove:function(t){if(t.__world!==this)throw new SSCD.IllegalActionError("Object to remove is not in this collision world!");for(var i=0;i<t.__grid_chunks.length;++i)for(var _=t.__grid_chunks[i],e=0;e<_.length;++e)if(_[e]===t){_.splice(e,1);break}delete this.__all_shapes[t.get_id()],t.__grid_chunks=[],t.__world=null,t.__grid_bounderies=null,t.__last_insert_aabb=null},__update_shape_grid:function(t){var i=t.get_aabb();(0===this.__params.grid_error||Math.abs(i.position.x-t.__last_insert_aabb.position.x)>this.__params.grid_error||Math.abs(i.position.y-t.__last_insert_aabb.position.y)>this.__params.grid_error||Math.abs(i.size.x-t.__last_insert_aabb.size.x)>this.__params.grid_error||Math.abs(i.size.y-t.__last_insert_aabb.size.y)>this.__params.grid_error)&&(this.remove(t),this.add(t))},pick_object:function(t,i){var _=[];return this.test_collision(t,i,_,1)?_[0]:null},test_collision:function(t,i,_,e){return i=this.__get_tags_value(i),t instanceof SSCD.Vector?this.__test_collision_point(t,i,_,e):t.is_shape?this.__test_collision_shape(t,i,_,e):void 0},__test_collision_point:function(t,i,_,e){var s=this.__params.grid_size,o=Math.floor(t.x/s),n=Math.floor(t.y/s);if(void 0===this.__grid[o]||void 0===this.__grid[o][n])return!1;for(var r=this.__grid[o][n],a=0,o=0;o<r.length;++o){var l=r[o];if(l.collision_tags_match(i)&&this.__do_collision(l,t)){if(!_)return!0;if(a++,_.push(l),e&&a>=e)return!0}}return a>0},__test_collision_shape:function(t,i,_,e){var s;s=t.__world===this?t.__grid_bounderies:this.__get_grid_range(t);for(var o=0,n={},r=s.min_x;r<=s.max_x;++r)if(void 0!==this.__grid[r])for(var a=s.min_y;a<=s.max_y;++a){var l=this.__grid[r][a];if(void 0!==l)for(var h=0;h<l.length;++h){var c=l[h];if(c!==t&&!n[c.get_id()]&&(n[c.get_id()]=!0,c.collision_tags_match(i)&&this.__do_collision(c,t))){if(!_)return!0;if(o++,_.push(c),e&&o>=e)return!0}}}return o>0},__do_collision:function(t,i){return t.test_collide_with(i)},render:function(t,i,_,e){i=i||SSCD.Vector.ZERO,void 0===_&&(_=!0),void 0===e&&(e=!0);var s=t.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var o=this.__params.grid_size,n=Math.floor(i.x/o),r=Math.floor(i.y/o),a=n+Math.ceil(t.width/o),l=r+Math.ceil(t.height/o),h=[],c=n;a>=c;++c)for(var S=r;l>=S;++S){var p=void 0;if(this.__grid[c]&&(p=this.__grid[c][S]),_){var u=new SSCD.Vector(c*o,S*o).sub_self(i);s.beginPath(),s.rect(u.x,u.y,o-1,o-1),s.lineWidth="1",s.strokeStyle=void 0===p||0===p.length?"rgba(100, 100, 100, 0.255)":"rgba(255, 0, 0, 0.3)",s.stroke()}if(void 0!==p)for(var f=0;f<p.length;++f){var d=p[f];-1===h.indexOf(d)&&h.push(p[f])}}for(var c=0;c<h.length;++c)h[c].render(s,i),e&&h[c].render_aabb(s,i)}},SSCD.IllegalActionError=function(t){this.name="Illegal Action",this.message=t||""},SSCD.IllegalActionError.prototype=Error.prototype;var SSCD=SSCD||{};SSCD.Math={},SSCD.Math.to_radians=function(t){return t*Math.PI/180},SSCD.Math.to_degrees=function(t){return 180*t/Math.PI},SSCD.Math.distance=function(t,i){var _=i.x-t.x,e=i.y-t.y;return Math.sqrt(_*_+e*e)},SSCD.Math.dist2=function(t,i){var _=i.x-t.x,e=i.y-t.y;return _*_+e*e},SSCD.Math.angle=function(t,i){var _=i.y-t.y,e=i.x-t.x;return 180*Math.atan2(_,e)/Math.PI},SSCD.Math.distance_to_line=function(t,i,_){var e=SSCD.Math.dist2(i,_),s=((t.x-i.x)*(_.x-i.x)+(t.y-i.y)*(_.y-i.y))/e;return 0>s?SSCD.Math.distance(t,i):s>1?SSCD.Math.distance(t,_):SSCD.Math.distance(t,{x:i.x+s*(_.x-i.x),y:i.y+s*(_.y-i.y)})},SSCD.Math.line_intersects=function(t,i,_,e){var s,o,n,r;s=i.x-t.x,o=i.y-t.y,n=e.x-_.x,r=e.y-_.y;var a,l;return a=(-o*(t.x-_.x)+s*(t.y-_.y))/(-n*o+s*r),l=(n*(t.y-_.y)-r*(t.x-_.x))/(-n*o+s*r),a>=0&&1>=a&&l>=0&&1>=l?1:0},SSCD.Math.is_on_line=function(t,i,_){return SSCD.Math.distance_to_line(t,i,_)<=5};var SSCD=SSCD||{};SSCD.Vector=function(t,i){this.x=t,this.y=i},SSCD.Vector.prototype={get_name:function(){return"vector"},clone:function(){return new SSCD.Vector(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},negative:function(){return this.multiply_scalar(-1)},negative_self:function(){return this.multiply_scalar_self(-1),this},distance_from:function(t){return SSCD.Math.distance(this,t)},angle_from:function(t){return SSCD.Math.angle(this,t)},move:function(t){return this.x+=t.x,this.y+=t.y,this},normalize_self:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?this:(this.x/=t,this.y/=t,this)},normalize:function(){return this.clone().normalize_self()},add_self:function(t){return this.x+=t.x,this.y+=t.y,this},sub_self:function(t){return this.x-=t.x,this.y-=t.y,this},divide_self:function(t){return this.x/=t.x,this.y/=t.y,this},multiply_self:function(t){return this.x*=t.x,this.y*=t.y,this},add_scalar_self:function(t){return this.x+=t,this.y+=t,this},sub_scalar_self:function(t){return this.x-=t,this.y-=t,this},divide_scalar_self:function(t){return this.x/=t,this.y/=t,this},multiply_scalar_self:function(t){return this.x*=t,this.y*=t,this},add:function(t){return this.clone().add_self(t)},sub:function(t){return this.clone().sub_self(t)},multiply:function(t){return this.clone().multiply_self(t)},divide:function(t){return this.clone().divide_self(t)},add_scalar:function(t){return this.clone().add_scalar_self(t)},sub_scalar:function(t){return this.clone().sub_scalar_self(t)},multiply_scalar:function(t){return this.clone().multiply_scalar_self(t)},divide_scalar:function(t){return this.clone().divide_scalar_self(t)},clamp:function(t,i){return this.x<t&&(this.x=t),this.y<t&&(this.y=t),this.x>i&&(this.x=i),this.y>i&&(this.y=i),this},from_angle:function(t){return this.x=Math.cos(t),this.y=Math.sin(t),this},apply_self:function(t){return this.x=t(this.x),this.y=t(this.y),this},apply:function(t){return this.clone().apply_self(t)},debug:function(){console.debug(this.x+", "+this.y)}},SSCD.Vector.ZERO=new SSCD.Vector(0,0),SSCD.Vector.ONE=new SSCD.Vector(1,1),SSCD.Vector.UP=new SSCD.Vector(0,-1),SSCD.Vector.DOWN=new SSCD.Vector(0,1),SSCD.Vector.LEFT=new SSCD.Vector(-1,0),SSCD.Vector.RIGHT=new SSCD.Vector(1,0),SSCD.Vector.UP_LEFT=new SSCD.Vector(-1,-1),SSCD.Vector.DOWN_LEFT=new SSCD.Vector(-1,1),SSCD.Vector.UP_RIGHT=new SSCD.Vector(1,-1),SSCD.Vector.DOWN_RIGHT=new SSCD.Vector(1,1);var SSCD=SSCD||{};SSCD.extend=function(t,i){for(var _ in t)i[_]||(i[_]=t[_]);i.__inits=i.__inits||[],t.__init__&&i.__inits.push(t.__init__),i.init=function(){for(var t=0;t<this.__inits.length;++t)this.__curr_init_func=this.__inits[t],this.__curr_init_func();delete this.__curr_init_func}},SSCD.NotImplementedError=function(t){this.name="NotImplementedError",this.message=t||""},SSCD.NotImplementedError.prototype=Error.prototype;var SSCD=SSCD||{};SSCD.AABB=function(t,i){this.position=t.clone(),this.size=i.clone()},SSCD.AABB.prototype={expand:function(t){var i=Math.min(this.position.x,t.position.x),_=Math.min(this.position.y,t.position.y),e=Math.max(this.position.x+this.size.x,t.position.x+t.size.x),s=Math.max(this.position.y+this.size.y,t.position.y+t.size.y);this.position.x=i,this.position.y=_,this.size.x=e-i,this.size.y=s-_},add_vector:function(t){var i=this.position.x-t.x;i>0&&(this.position.x-=i,this.size.x+=i);var _=this.position.y-t.y;_>0&&(this.position.y-=_,this.size.y+=_);var e=t.x-(this.position.x+this.size.x);e>0&&(this.size.x+=e);var s=t.y-(this.position.y+this.size.y);s>0&&(this.size.y+=s)},clone:function(){return new SSCD.AABB(this.position,this.size)}};var SSCD=SSCD||{};SSCD.Shape=function(){},SSCD.Shape.prototype={__type:"shape",is_shape:!0,__data:null,__next_id:0,__collision_tags:[],__collision_tags_val:SSCD.World.prototype._ALL_TAGS_VAL,__init__:function(){this.__position=new SSCD.Vector,this.__grid_chunks=[],this.__world=null,this.__grid_bounderies=null,this.__last_insert_aabb=null,this.__id=SSCD.Shape.prototype.__next_id++},get_id:function(){return this.__id},set_collision_tags:function(t){if(null===this.__world)throw new SSCD.IllegalActionError("Can't set tags for a shape that is not inside a collision world!");return this.__collision_tags_val=this.__world.__get_tags_value(t),!t instanceof Array&&(t=[t]),this.__collision_tags=t,this.__update_tags_hook&&this.__update_tags_hook(),this},__update_tags_hook:null,get_collision_tags:function(){return this.__collision_tags},collision_tags_match:function(t){if(isNaN(t)){if(null===this.__world)throw new SSCD.IllegalActionError("If you provide tags as string(s) the shape must be inside a collision world to convert them!");t=this.__world.__get_tags_value(t)}return 0!==(this.__collision_tags_val&t)},test_collide_with:function(t){return SSCD.CollisionManager.test_collision(this,t)},repel:function(t,i,_){i=i||1,_=_||1;for(var e=this.get_repel_direction(t).multiply_scalar_self(i),s=SSCD.Vector.ZERO.clone(),o=!0;o&&_>0;)_--,t.move(e),s.add_self(e),o=this.test_collide_with(t);return s},get_repel_direction:function(t){var i,_=this.get_abs_center();return i=t instanceof SSCD.Vector?t:t.get_abs_center(),i.sub(_).normalize_self()},__get_render_fill_color:function(t){return this.__override_fill_color?this.__override_fill_color:this.__collision_tags_to_color(this.__collision_tags_val,t)},__get_render_stroke_color:function(t){return this.__override_stroke_color?this.__override_stroke_color:this.__collision_tags_to_color(this.__collision_tags_val,t)},set_debug_render_colors:function(t,i){this.__override_fill_color=t,this.__override_stroke_color=i},__override_fill_color:null,__override_stroke_color:null,__collision_tags_to_color:function(t,i){var _=Math.round(255*Math.abs(Math.sin(t))),e=Math.round(255*Math.abs(Math.cos(t))),s=Math.round(_^e);return"rgba("+_+","+e+","+s+","+i+")"},set_data:function(t){return this.__data=t,this},get_data:function(){return this.__data},get_name:function(){return this.__type},render_aabb:function(t,i){var _=this.get_aabb();t.beginPath(),t.rect(_.position.x-i.x,_.position.y-i.y,_.size.x,_.size.y),t.lineWidth="1",t.strokeStyle="rgba(50, 175, 45, 0.5)",t.stroke()},set_position:function(t){return this.__position.x=t.x,this.__position.y=t.y,this.__update_position(),this},get_position:function(){return this.__position.clone()},move:function(t){return this.set_position(this.__position.add(t)),this},__update_position:function(){this.__update_position_hook&&this.__update_position_hook(),this.__aabb&&this.__update_aabb_pos(),this.__update_parent_world()},__update_aabb_pos:function(){this.__aabb.position=this.__position},get_abs_center:function(){var t=this.get_aabb();return t.position.add(t.size.multiply_scalar(.5))},reset_aabb:function(){this.__aabb=void 0},__update_parent_world:function(){this.__world&&this.__world.__update_shape_grid(this)},__update_position_hook:null,render:function(){throw new SSCD.NotImplementedError},build_aabb:function(){throw new SSCD.NotImplementedError},get_aabb:function(){return this.__aabb=this.__aabb||this.build_aabb(),this.__aabb}};var SSCD=SSCD||{};SSCD.Circle=function(t,i){this.init(),this.__radius=i,this.__size=new SSCD.Vector(i,i).multiply_scalar_self(2),this.set_position(t)},SSCD.Circle.prototype={__type:"circle",render:function(t,i){var _=this.__position.sub(i);t.beginPath(),t.arc(_.x,_.y,this.__radius,0,2*Math.PI,!1),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke(),t.fillStyle=this.__get_render_fill_color(.35),t.fill()},get_radius:function(){return this.__radius},__update_aabb_pos:function(){this.__aabb.position=this.__position.sub_scalar(this.__radius)},build_aabb:function(){return new SSCD.AABB(this.__position.sub_scalar(this.__radius),this.__size)},get_abs_center:function(){return this.__position.clone()}},SSCD.extend(SSCD.Shape.prototype,SSCD.Circle.prototype);var SSCD=SSCD||{};SSCD.Rectangle=function(t,i){this.init(),this.__size=i,this.set_position(t)},SSCD.Rectangle.prototype={__type:"rectangle",render:function(t,i){var _=this.__position.sub(i);t.beginPath(),t.rect(_.x,_.y,this.__size.x,this.__size.y),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke(),t.fillStyle=this.__get_render_fill_color(.35),t.fill()},get_size:function(){return this.__size.clone()},build_aabb:function(){return new SSCD.AABB(this.__position,this.__size)},get_top_left:function(){return this.__top_left_c=this.__top_left_c||this.__position.clone(),this.__top_left_c},get_bottom_left:function(){return this.__bottom_left_c=this.__bottom_left_c||this.__position.add(new SSCD.Vector(0,this.__size.y)),this.__bottom_left_c},get_top_right:function(){return this.__top_right_c=this.__top_right_c||this.__position.add(new SSCD.Vector(this.__size.x,0)),this.__top_right_c},get_bottom_right:function(){return this.__bottom_right_c=this.__bottom_right_c||this.__position.add(new SSCD.Vector(this.__size.x,this.__size.y)),this.__bottom_right_c},get_abs_center:function(){return this.__abs_center_c=this.__abs_center_c||this.__position.add(this.__size.divide_scalar(2)),this.__abs_center_c},__update_position_hook:function(){this.__top_left_c=void 0,this.__top_right_c=void 0,this.__bottom_left_c=void 0,this.__bottom_right_c=void 0,this.__abs_center_c=void 0}},SSCD.extend(SSCD.Shape.prototype,SSCD.Rectangle.prototype);var SSCD=SSCD||{};SSCD.Line=function(t,i){this.init(),this.__dest=i,this.set_position(t)},SSCD.Line.prototype={__type:"line",render:function(t){t.beginPath(),t.moveTo(this.__position.x,this.__position.y);var i=this.__position.add(this.__dest);t.lineTo(i.x,i.y),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke()},build_aabb:function(){var t=new SSCD.Vector(0,0);t.x=this.__dest.x>0?this.__position.x:this.__position.x-this.__dest.x,t.y=this.__dest.y>0?this.__position.y:this.__position.y-this.__dest.y;var i=this.__dest.apply(Math.abs);return new SSCD.AABB(t,i)},get_p1:function(){return this.__p1_c=this.__p1_c||this.__position.clone(),this.__p1_c},get_p2:function(){return this.__p2_c=this.__p2_c||this.__position.add(this.__dest),this.__p2_c},__update_position_hook:function(){this.__p1_c=void 0,this.__p2_c=void 0}},SSCD.extend(SSCD.Shape.prototype,SSCD.Line.prototype);var SSCD=SSCD||{};SSCD.LineStrip=function(t,i,_){if(this.init(),this.__points=i,i.length<=1)throw new SSCD.IllegalActionError("Not enough vectors for LineStrip (got to have at least two vectors)");_&&this.__points.push(this.__points[0]),this.set_position(t)},SSCD.LineStrip.prototype={__type:"line-strip",render:function(t){var i=void 0;t.beginPath();for(var _=0;_<this.__points.length-1;++_){var e=this.__position.add(this.__points[_]);i=this.__position.add(this.__points[_+1]),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y)}t.moveTo(i.x,i.y),i=this.__position.add(this.__points[this.__points.length-1]),t.lineTo(i.x,i.y),t.lineWidth="7",t.strokeStyle=this.__get_render_stroke_color(.75),t.stroke()},get_abs_lines:function(){if(this.__abs_lines_c)return this.__abs_lines_c;for(var t=this.get_abs_points(),i=[],_=0;_<t.length-1;_++)i.push([t[_],t[_+1]]);return this.__abs_lines_c=i,i},get_abs_points:function(){if(this.__abs_points_c)return this.__abs_points_c;for(var t=[],i=0;i<this.__points.length;i++)t.push(this.__points[i].add(this.__position));return this.__abs_points_c=t,t},__update_position_hook:function(){this.__abs_points_c=void 0,this.__abs_lines_c=void 0},__update_aabb_pos:function(){this.__aabb.position.set(this.__aabb_offset_c.add(this.__position))},build_aabb:function(){for(var t=new SSCD.AABB(SSCD.Vector.ZERO,SSCD.Vector.ZERO),i=0;i<this.__points.length;++i)t.add_vector(this.__points[i]);return this.__aabb_offset_c=t.position.clone(),t.position.add_self(this.__position),t}},SSCD.extend(SSCD.Shape.prototype,SSCD.LineStrip.prototype);var SSCD=SSCD||{};SSCD.CompositeShape=function(t,i){if(this.init(),this.__shapes=[],t=t||SSCD.Vector.ZERO,this.set_position(t),i)for(var _=0;_<i.length;++_)this.add(i[_])},SSCD.CompositeShape.prototype={__type:"composite-shape",render:function(t,i){for(var _=0;_<this.__shapes.length;++_)this.__shapes[_].shape.render(t,i)},repel:function(t,i,_){for(var e=SSCD.Vector.ZERO.clone(),s=0;s<this.__shapes.length;++s){var o=this.__shapes[s].shape;o.test_collide_with(t)&&e.add_self(o.repel(t,i,_))}return e},set_debug_render_colors:function(t,i){this.__override_fill_color=t,this.__override_stroke_color=i;for(var _=0;_<this.__shapes.length;++_)this.__shapes[_].shape.set_debug_render_colors(t,i)},get_shapes:function(){if(this.__shapes_list_c)return this.__shapes_list_c;for(var t=[],i=0;i<this.__shapes.length;++i)t.push(this.__shapes[i].shape);return this.__shapes_list_c=t,t},build_aabb:function(){if(0===this.__shapes.length)return this.__aabb_pos_offset_c=SSCD.Vector.ZERO,new SSCD.AABB(SSCD.Vector.ZERO,SSCD.Vector.ZERO);for(var t=null,i=0;i<this.__shapes.length;++i){var _=this.__shapes[i].shape.get_aabb();t?t.expand(_):t=_}return this.__aabb_pos_offset_c=t.position.sub(this.__position),t},__update_aabb_pos:function(){this.__aabb.position=this.__position.add(this.__aabb_pos_offset_c)},add:function(t){if(t.__world)throw new SSCD.IllegalActionError("Can't add shape with collision world to a composite shape!");var i=t.__position;return this.__shapes_list_c=void 0,this.__shapes.push({shape:t,offset:i.clone()}),t.set_position(this.__position.add(i)),this.reset_aabb(),this.__update_parent_world(),t.__collision_tags_val=this.__collision_tags_val,t.__collision_tags=this.__collision_tags,t.__override_fill_color=this.__override_fill_color,t.__override_stroke_color=this.__override_stroke_color,t},__update_tags_hook:function(){for(var t=0;t<this.__shapes;++t){var i=this.__shapes[t].shape;i.__collision_tags_val=this.__collision_tags_val,i.__collision_tags=this.__collision_tags}},remove:function(t){this.__shapes_list_c=void 0;for(var i=0;i<this.__shapes.length;++i)if(this.__shapes[i].shape===t)return this.__shapes.splice(i,1),void this.__update_parent_world();throw new SSCD.IllegalActionError("Shape to remove is not in composite shape!")},__update_position_hook:function(){for(var t=0;t<this.__shapes.length;++t)this.__shapes[t].shape.set_position(this.__position.add(this.__shapes[t].offset))}},SSCD.extend(SSCD.Shape.prototype,SSCD.CompositeShape.prototype);var SSCD=SSCD||{};SSCD.CollisionManager={test_collision:function(t,i){if(t instanceof SSCD.Vector&&i instanceof SSCD.Vector)return this._test_collision_vector_vector(t,i);if(t instanceof SSCD.CompositeShape)return this._test_collision_composite_shape(t,i);if(i instanceof SSCD.CompositeShape)return this._test_collision_composite_shape(i,t);if(t instanceof SSCD.Vector&&i instanceof SSCD.Circle)return this._test_collision_circle_vector(i,t);if(t instanceof SSCD.Circle&&i instanceof SSCD.Vector)return this._test_collision_circle_vector(t,i);if(t instanceof SSCD.Circle&&i instanceof SSCD.Circle)return this._test_collision_circle_circle(i,t);if(t instanceof SSCD.Circle&&i instanceof SSCD.Rectangle)return this._test_collision_circle_rect(t,i);if(t instanceof SSCD.Rectangle&&i instanceof SSCD.Circle)return this._test_collision_circle_rect(i,t);if(t instanceof SSCD.Circle&&i instanceof SSCD.Line)return this._test_collision_circle_line(t,i);if(t instanceof SSCD.Line&&i instanceof SSCD.Circle)return this._test_collision_circle_line(i,t);if(t instanceof SSCD.LineStrip&&i instanceof SSCD.Line)return this._test_collision_linestrip_line(t,i);if(t instanceof SSCD.Line&&i instanceof SSCD.LineStrip)return this._test_collision_linestrip_line(i,t);if(t instanceof SSCD.Circle&&i instanceof SSCD.LineStrip)return this._test_collision_circle_linestrip(t,i);if(t instanceof SSCD.LineStrip&&i instanceof SSCD.Circle)return this._test_collision_circle_linestrip(i,t);if(t instanceof SSCD.Vector&&i instanceof SSCD.Rectangle)return this._test_collision_rect_vector(i,t);if(t instanceof SSCD.Rectangle&&i instanceof SSCD.Vector)return this._test_collision_rect_vector(t,i);if(t instanceof SSCD.Rectangle&&i instanceof SSCD.Rectangle)return this._test_collision_rect_rect(i,t);if(t instanceof SSCD.LineStrip&&i instanceof SSCD.LineStrip)return this._test_collision_linestrip_linestrip(t,i);if(t instanceof SSCD.Line&&i instanceof SSCD.Rectangle)return this._test_collision_rect_line(i,t);if(t instanceof SSCD.Rectangle&&i instanceof SSCD.Line)return this._test_collision_rect_line(t,i);if(t instanceof SSCD.LineStrip&&i instanceof SSCD.Rectangle)return this._test_collision_rect_linestrip(i,t);if(t instanceof SSCD.Rectangle&&i instanceof SSCD.LineStrip)return this._test_collision_rect_linestrip(t,i);if(t instanceof SSCD.Line&&i instanceof SSCD.Line)return this._test_collision_line_line(t,i);if(t instanceof SSCD.Line&&i instanceof SSCD.Vector)return this._test_collision_vector_line(i,t);if(t instanceof SSCD.Vector&&i instanceof SSCD.Line)return this._test_collision_vector_line(t,i);if(t instanceof SSCD.LineStrip&&i instanceof SSCD.Vector)return this._test_collision_vector_linestrip(i,t);if(t instanceof SSCD.Vector&&i instanceof SSCD.LineStrip)return this._test_collision_vector_linestrip(t,i);throw new SSCD.UnsupportedShapes(t,i)},_test_collision_vector_vector:function(t,i){return t.x===i.x&&t.y===i.y},_test_collision_circle_vector:function(t,i){return SSCD.Math.distance(t.__position,i)<=t.__radius},_test_collision_circle_circle:function(t,i){return SSCD.Math.distance(t.__position,i.__position)<=t.__radius+i.__radius},_test_collision_rect_vector:function(t,i){return i.x>=t.__position.x&&i.y>=t.__position.y&&i.x<=t.__position.x+t.__size.x&&i.y<=t.__position.y+t.__size.y},_test_collision_vector_line:function(t,i){return SSCD.Math.is_on_line(t,i.get_p1(),i.get_p2())},_test_collision_vector_linestrip:function(t,i){for(var _=i.get_abs_lines(),e=0;e<_.length;++e)if(SSCD.Math.is_on_line(t,_[e][0],_[e][1]))return!0;return!1},_test_collision_circle_line:function(t,i){return SSCD.Math.distance_to_line(t.__position,i.get_p1(),i.get_p2())<=t.__radius},_test_collision_circle_linestrip:function(t,i){for(var _=i.get_abs_lines(),e=0;e<_.length;++e)if(SSCD.Math.distance_to_line(t.__position,_[e][0],_[e][1])<=t.__radius)return!0;return!1},_test_collision_linestrip_line:function(t,i){for(var _=t.get_abs_lines(),e=i.get_p1(),s=i.get_p2(),o=0;o<_.length;++o)if(SSCD.Math.line_intersects(e,s,_[o][0],_[o][1]))return!0;return!1},_test_collision_line_line:function(t,i){return SSCD.Math.line_intersects(t.get_p1(),t.get_p2(),i.get_p1(),i.get_p2())},_test_collision_rect_line:function(t,i){var _=i.get_p1(),e=i.get_p2();if(SSCD.CollisionManager._test_collision_rect_vector(t,_)||SSCD.CollisionManager._test_collision_rect_vector(t,e))return!0;var s=t.get_top_left(),o=t.get_bottom_left();if(SSCD.Math.line_intersects(_,e,s,o))return!0;var n=t.get_top_right(),r=t.get_bottom_right();return SSCD.Math.line_intersects(_,e,n,r)?!0:SSCD.Math.line_intersects(_,e,s,n)?!0:SSCD.Math.line_intersects(_,e,o,r)?!0:!1},_test_collision_rect_linestrip:function(t,i){for(var _=i.get_abs_points(),e=0;e<_.length;++e)if(this._test_collision_rect_vector(t,_[e]))return!0;for(var s=t.get_top_left(),o=t.get_bottom_left(),n=t.get_top_right(),r=t.get_bottom_right(),a=i.get_abs_lines(),e=0;e<a.length;++e){var l=a[e][0],h=a[e][1];if(SSCD.Math.line_intersects(l,h,s,o))return!0;if(SSCD.Math.line_intersects(l,h,n,r))return!0;if(SSCD.Math.line_intersects(l,h,s,n))return!0;if(SSCD.Math.line_intersects(l,h,o,r))return!0}return!1},_test_collision_linestrip_linestrip:function(t,i){for(var _=t.get_abs_lines(),e=i.get_abs_lines(),s=0;s<_.length;++s)for(var o=0;o<e.length;++o)if(SSCD.Math.line_intersects(_[s][0],_[s][1],e[o][0],e[o][1]))return!0;return!1},_test_collision_composite_shape:function(t,i){var _=t.get_shapes();if(i instanceof SSCD.CompositeShape){for(var e=i.get_shapes(),s=0;s<_.length;++s)for(var o=0;o<e.length;++o)if(SSCD.CollisionManager.test_collision(_[s],e[o]))return!0}else for(var s=0;s<_.length;++s)if(SSCD.CollisionManager.test_collision(_[s],i))return!0;return!1},_test_collision_circle_rect:function(t,i){var _=t.__position,e=SSCD.CollisionManager._test_collision_rect_vector(i,_);if(e)return!0;var s=i.get_abs_center(),e=SSCD.CollisionManager._test_collision_circle_vector(t,s);if(e)return!0;var o=[];o.push(s.x>_.x?[i.get_top_left(),i.get_bottom_left()]:[i.get_top_right(),i.get_bottom_right()]),o.push(s.y>_.y?[i.get_top_left(),i.get_top_right()]:[i.get_bottom_left(),i.get_bottom_right()]);for(var n=0;n<o.length;++n){var r=SSCD.Math.distance_to_line(_,o[n][0],o[n][1]);if(r<=t.__radius)return!0}return!1},_test_collision_rect_rect:function(t,i){var _={left:t.__position.x,right:t.__position.x+t.__size.x,top:t.__position.y,bottom:t.__position.y+t.__size.y},e={left:i.__position.x,right:i.__position.x+i.__size.x,top:i.__position.y,bottom:i.__position.y+i.__size.y};return!(e.left>_.right||e.right<_.left||e.top>_.bottom||e.bottom<_.top)}},SSCD.UnsupportedShapes=function(t,i){this.name="Unsupported Shapes",this.message="Unsupported shapes collision test! '"+t.get_name()+"' <-> '"+i.get_name()+"'."},SSCD.UnsupportedShapes.prototype=Error.prototype,"undefined"!=typeof exports&&(exports.sscd=SSCD);